<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      -->
<title>compare_with_morel</title>
<meta name="generator" content="MATLAB 23.2">
<link rel="schema.DC" href="http://purl.org/dc/elements/1.1/">
<meta name="DC.date" content="2024-02-19">
<meta name="DC.source" content="compare_with_morel.m">
<style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; }

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }
span.typesection { color:#A0522D }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style>
</head>
<body>
<div class="content">
<h2>Contents</h2>
<div>
<ul>
<li>
<a href="#2">plot overlaps</a>
</li>
<li>
<a href="#7">compute overlap statistic</a>
</li>
</ul>
</div>
<pre class="codeinput">clear <span class="string">all</span>;
close <span class="string">all</span>;

addpath(<span class="string">'/home/bogdan/.matlab/spm/spm12'</span>);
addpath(genpath(<span class="string">'/home/bogdan/.matlab/canlab/CanlabCore'</span>))
addpath(genpath(<span class="string">'/home/bogdan/.matlab/canlab/Neuroimaging_Pattern_Masks'</span>))
addpath(genpath(<span class="string">'/home/bogdan/.matlab/canlab/MasksPrivate'</span>))

leaddbsRoot=<span class="string">'/home/bogdan/MyDocuments/canlab/atlases/_resources/LeadsDBS/'</span>;

myAtlas = load_atlas(<span class="string">'iglesias_thal_fmriprep20'</span>);

<span class="comment">% note, this requires MasksPrivate</span>
morel = load_atlas(<span class="string">'morel_fmriprep20'</span>)
</pre>
<pre class="codeoutput">Loading atlas: /home/bogdan/.matlab/canlab/Neuroimaging_Pattern_Masks/Atlases_and_parcellations/2018_Iglesias_thalamic_HCP278_reconstruction/iglesias_hcp278_MNI152NLin2009cAsym_atlas_object.mat
Loading atlas: /home/bogdan/.matlab/canlab/MasksPrivate/Masks_private/2010_MorelAtlasMNI152/Morel_MNI152NLin2009cAsym_atlas_object.mat

morel = 

  atlas with properties:

               atlas_name: 'Morel_MNI152NLin2009cAsym'
         probability_maps: []
                   labels: {1&times;74 cell}
       label_descriptions: {74&times;1 cell}
                 labels_2: {''}
                 labels_3: {''}
                 labels_4: {''}
                 labels_5: {''}
               references: [2&times;227 char]
        space_description: 'MNI152NLin2009cAsym'
    property_descriptions: {1&times;8 cell}
          additional_info: [0&times;0 struct]
                      dat: [2818624&times;1 int32]
              dat_descrip: []
                  volInfo: [1&times;1 struct]
           removed_voxels: 0
           removed_images: 0
              image_names: 'morel_atlas_MNI152NLin2009cAsym.nii'
                 fullpath: '/home/bogdan/.matlab/canlab/MasksPrivate/Masks_private/2010_MorelAtlasMNI152/morel_atlas_MNI152NLin2009cAsym.nii'
              files_exist: 1
                  history: {1&times;4 cell}

</pre>
<h2 id="2">plot overlaps</h2>
<pre class="codeinput">
<span class="comment">% equivalence mapping {{iglesias}, {morel}}</span>
emap = {{{<span class="string">'AV'</span>},{<span class="string">'AD'</span>,<span class="string">'AM'</span>,<span class="string">'AV'</span>}},<span class="keyword">...</span>
    {{<span class="string">'CeM'</span>},{<span class="string">'CeM'</span>}},<span class="keyword">...</span>
    {{<span class="string">'CL'</span>},{<span class="string">'CL'</span>}},<span class="keyword">...</span>
    {{<span class="string">'CM'</span>},{<span class="string">'CM'</span>}},<span class="keyword">...</span>
    {{<span class="string">'LD'</span>},{<span class="string">'LD'</span>}},<span class="keyword">...</span>
    {{<span class="string">'LGN'</span>},{<span class="string">'LGNmc'</span>,<span class="string">'LGNpc'</span>}},<span class="keyword">...</span>
    {{<span class="string">'LP'</span>},{<span class="string">'LP'</span>}},<span class="keyword">...</span>
    {{<span class="string">'L_SG'</span>},{<span class="string">'SG'</span>,<span class="string">'Li'</span>}},<span class="keyword">...</span>
    {{<span class="string">'MDl'</span>},{<span class="string">'MDpc'</span>}},<span class="keyword">...</span>
    {{<span class="string">'MDm'</span>},{<span class="string">'MDmc'</span>}},<span class="keyword">...</span>
    {{<span class="string">'MGN'</span>},{<span class="string">'MGN'</span>}},<span class="keyword">...</span>
    {{<span class="string">'MV_Re'</span>},{<span class="string">'MV'</span>}},<span class="keyword">...</span>
    {{<span class="string">'Pf'</span>},{<span class="string">'Pf'</span>}},<span class="keyword">...</span>
    {{<span class="string">'PuA'</span>},{<span class="string">'PuA'</span>}},<span class="keyword">...</span>
    {{<span class="string">'PuI'</span>},{<span class="string">'PuI'</span>,<span class="string">'Po'</span>}},<span class="keyword">...</span>
    {{<span class="string">'PuL'</span>},{<span class="string">'PuL'</span>}},<span class="keyword">...</span>
    {{<span class="string">'VA'</span>},{<span class="string">'VApc'</span>}},<span class="keyword">...</span>
    {{<span class="string">'VAmc'</span>},{<span class="string">'VAmc'</span>}},<span class="keyword">...</span>
    {{<span class="string">'VLa'</span>},{<span class="string">'VLa'</span>}},<span class="keyword">...</span>
    {{<span class="string">'VLp'</span>},{<span class="string">'VLpd'</span>,<span class="string">'VLpv'</span>,<span class="string">'VM'</span>}},<span class="keyword">...</span>
    {{<span class="string">'VPL'</span>},{<span class="string">'VPLa'</span>,<span class="string">'VPLp'</span>,<span class="string">'VPI'</span>,<span class="string">'VPM'</span>}},<span class="keyword">...</span>
    {{<span class="string">'PuMm'</span>,<span class="string">'PuMl'</span>},{<span class="string">'PuM'</span>}}};

thisAtlas = myAtlas.select_atlas_subset({<span class="string">'L_'</span>}).threshold(0.2);
thisAtlas = thisAtlas.select_atlas_subset(find(~contains(thisAtlas.labels,{<span class="string">'R_L'</span>})));
thisAtlas.probability_maps = [];
thisMorelAtlas = morel.select_atlas_subset({<span class="string">'L_'</span>});

[newAtlas1, newAtlas2] = deal({});
<span class="keyword">for</span> i = 1:length(emap)
    newAtlas1{end+1} = thisAtlas.select_atlas_subset(emap{i}{1},<span class="string">'flatten'</span>);
    newAtlas2{end+1} = thisMorelAtlas.select_atlas_subset(emap{i}{2},<span class="string">'flatten'</span>);
<span class="keyword">end</span>
thisAtlas = [newAtlas1{:}];
thisMorelAtlas = [newAtlas2{:}];

<span class="keyword">for</span> orientation = {<span class="string">'saggital'</span>,<span class="string">'coronal'</span>,<span class="string">'axial'</span>}
</pre>
<pre class="codeinput">    o2 = thisAtlas.montage(<span class="string">'transvalue'</span>,0.5,<span class="string">'regioncenters'</span>,orientation{1});
    <span class="keyword">for</span> i = 1:num_regions(thisAtlas)
        <span class="keyword">try</span>
            morel_roi = thisMorelAtlas.select_atlas_subset(i);

            <span class="keyword">if</span> num_regions(morel_roi) == 1
                o3 = o2;
                o3.activation_maps = o2.activation_maps(i);
                o3.montage = o2.montage(i);
                morel_roi.montage(o3,<span class="string">'existing_figure'</span>,<span class="string">'existing_axes'</span>, o2.montage{i}.axis_handles,<span class="string">'outline'</span>,<span class="string">'color'</span>,[0,0,0]);
            <span class="keyword">end</span>
        <span class="keyword">end</span>
    <span class="keyword">end</span>

    drawnow()
</pre>
<pre class="codeoutput">Compressed NIfTI files are not supported.
Warning: Unknown input string option:saggital 
Warning: Unknown input string option:saggital 
Warning: Unknown input string option:saggital 
Warning: Unknown input string option:saggital 
Warning: Unknown input string option:saggital 
Warning: Unknown input string option:saggital 
Warning: Unknown input string option:saggital 
Warning: Unknown input string option:saggital 
Warning: Unknown input string option:saggital 
Warning: Unknown input string option:saggital 
Warning: Unknown input string option:saggital 
Warning: Unknown input string option:saggital 
Warning: Unknown input string option:saggital 
Warning: Unknown input string option:saggital 
Warning: Unknown input string option:saggital 
Warning: Unknown input string option:saggital 
Warning: Unknown input string option:saggital 
Warning: Unknown input string option:saggital 
Warning: Unknown input string option:saggital 
Warning: Unknown input string option:saggital 
Warning: Unknown input string option:saggital 
Warning: Unknown input string option:saggital 
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
sagittal montage:  80 voxels displayed, 295 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
sagittal montage:  27 voxels displayed, 147 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
sagittal montage:  31 voxels displayed, 859 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
sagittal montage:  58 voxels displayed, 245 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
sagittal montage:  17 voxels displayed, 143 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
sagittal montage:  33 voxels displayed, 212 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
sagittal montage:   0 voxels displayed, 500 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
sagittal montage:   8 voxels displayed, 106 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
sagittal montage:  88 voxels displayed, 834 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
sagittal montage:   7 voxels displayed, 227 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
sagittal montage:  16 voxels displayed, 208 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
sagittal montage:   3 voxels displayed,   6 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
sagittal montage:  28 voxels displayed, 126 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
sagittal montage:  19 voxels displayed, 135 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
sagittal montage:   6 voxels displayed, 118 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
sagittal montage:   0 voxels displayed, 416 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
sagittal montage:  89 voxels displayed, 517 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
sagittal montage:  35 voxels displayed,  49 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
sagittal montage:  51 voxels displayed, 324 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
sagittal montage: 147 voxels displayed, 1450 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
sagittal montage:  79 voxels displayed, 674 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
sagittal montage: 142 voxels displayed, 1724 not displayed on these slices
</pre>
<img vspace="5" hspace="5" src="compare_with_morel_01.png" alt=""> <pre class="codeoutput">Compressed NIfTI files are not supported.
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
coronal montage:  33 voxels displayed, 342 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
coronal montage:  17 voxels displayed, 157 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
coronal montage:  31 voxels displayed, 859 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
coronal montage:  46 voxels displayed, 257 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
coronal montage:  14 voxels displayed, 146 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
coronal montage:  17 voxels displayed, 228 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
coronal montage:   1 voxels displayed, 499 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
coronal montage:  27 voxels displayed,  87 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
coronal montage:  84 voxels displayed, 838 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
coronal montage:  23 voxels displayed, 211 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
coronal montage:  39 voxels displayed, 185 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
coronal montage:   2 voxels displayed,   7 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
coronal montage:  23 voxels displayed, 131 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
coronal montage:  26 voxels displayed, 128 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
coronal montage:  19 voxels displayed, 105 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
coronal montage:  25 voxels displayed, 391 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
coronal montage: 112 voxels displayed, 494 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
coronal montage:   3 voxels displayed,  81 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
coronal montage:  62 voxels displayed, 313 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
coronal montage: 170 voxels displayed, 1427 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
coronal montage: 117 voxels displayed, 636 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
coronal montage: 227 voxels displayed, 1639 not displayed on these slices
</pre>
<img vspace="5" hspace="5" src="compare_with_morel_02.png" alt=""> <pre class="codeoutput">Compressed NIfTI files are not supported.
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
axial montage:  23 voxels displayed, 352 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
axial montage:  29 voxels displayed, 145 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
axial montage:  90 voxels displayed, 800 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
axial montage:  57 voxels displayed, 246 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
axial montage:  43 voxels displayed, 117 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
axial montage:  23 voxels displayed, 222 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
axial montage:  39 voxels displayed, 461 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
axial montage:  21 voxels displayed,  93 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
axial montage: 100 voxels displayed, 822 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
axial montage:  37 voxels displayed, 197 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
axial montage:  28 voxels displayed, 196 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
axial montage:   0 voxels displayed,   9 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
axial montage:  43 voxels displayed, 111 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
axial montage:   0 voxels displayed, 154 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
axial montage:   0 voxels displayed, 124 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
axial montage:  10 voxels displayed, 406 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
axial montage:  41 voxels displayed, 565 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
axial montage:   2 voxels displayed,  82 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
axial montage:  30 voxels displayed, 345 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
axial montage:  67 voxels displayed, 1530 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
axial montage:  41 voxels displayed, 712 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
axial montage: 129 voxels displayed, 1737 not displayed on these slices
</pre>
<img vspace="5" hspace="5" src="compare_with_morel_03.png" alt=""> <pre class="codeinput">
<span class="keyword">end</span>


thisAtlas = myAtlas.select_atlas_subset({<span class="string">'R_'</span>}).threshold(0.2);
thisAtlas.probability_maps = [];
thisMorelAtlas = morel.select_atlas_subset({<span class="string">'R_'</span>});

[newAtlas1, newAtlas2] = deal({});
<span class="keyword">for</span> i = 1:length(emap)
    newAtlas1{end+1} = thisAtlas.select_atlas_subset(emap{i}{1},<span class="string">'flatten'</span>);
    newAtlas2{end+1} = thisMorelAtlas.select_atlas_subset(emap{i}{2},<span class="string">'flatten'</span>);
<span class="keyword">end</span>
thisAtlas = [newAtlas1{:}];
thisMorelAtlas = [newAtlas2{:}];

<span class="keyword">for</span> orientation = {<span class="string">'saggital'</span>,<span class="string">'coronal'</span>,<span class="string">'axial'</span>}
</pre>
<pre class="codeinput">    o2 = thisAtlas.montage(<span class="string">'transvalue'</span>,0.5,<span class="string">'regioncenters'</span>,orientation{1});
    <span class="keyword">for</span> i = 1:num_regions(thisAtlas)
        <span class="keyword">try</span>
            morel_roi = thisMorelAtlas.select_atlas_subset(i);

            <span class="keyword">if</span> num_regions(morel_roi) == 1
                o3 = o2;
                o3.activation_maps = o2.activation_maps(i);
                o3.montage = o2.montage(i);
                morel_roi.montage(o3,<span class="string">'existing_figure'</span>,<span class="string">'existing_axes'</span>, o2.montage{i}.axis_handles,<span class="string">'outline'</span>,<span class="string">'color'</span>,[0,0,0]);
            <span class="keyword">end</span>
        <span class="keyword">end</span>
    <span class="keyword">end</span>

    drawnow()
</pre>
<pre class="codeoutput">Compressed NIfTI files are not supported.
Warning: Unknown input string option:saggital 
Warning: Unknown input string option:saggital 
Warning: Unknown input string option:saggital 
Warning: Unknown input string option:saggital 
Warning: Unknown input string option:saggital 
Warning: Unknown input string option:saggital 
Warning: Unknown input string option:saggital 
Warning: Unknown input string option:saggital 
Warning: Unknown input string option:saggital 
Warning: Unknown input string option:saggital 
Warning: Unknown input string option:saggital 
Warning: Unknown input string option:saggital 
Warning: Unknown input string option:saggital 
Warning: Unknown input string option:saggital 
Warning: Unknown input string option:saggital 
Warning: Unknown input string option:saggital 
Warning: Unknown input string option:saggital 
Warning: Unknown input string option:saggital 
Warning: Unknown input string option:saggital 
Warning: Unknown input string option:saggital 
Warning: Unknown input string option:saggital 
Warning: Unknown input string option:saggital 
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
sagittal montage:  65 voxels displayed, 324 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
sagittal montage:  41 voxels displayed, 139 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
sagittal montage:  24 voxels displayed, 878 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
sagittal montage:  54 voxels displayed, 240 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
sagittal montage:  12 voxels displayed, 137 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
sagittal montage:  25 voxels displayed, 234 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
sagittal montage:   0 voxels displayed, 480 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
sagittal montage:   9 voxels displayed, 106 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
sagittal montage: 103 voxels displayed, 844 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
sagittal montage:  67 voxels displayed, 161 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
sagittal montage:  18 voxels displayed, 208 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
sagittal montage:   6 voxels displayed,   3 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
sagittal montage:  32 voxels displayed, 123 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
sagittal montage:   0 voxels displayed, 157 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
sagittal montage:   7 voxels displayed, 126 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
sagittal montage:   0 voxels displayed, 404 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
sagittal montage:  57 voxels displayed, 535 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
sagittal montage:  28 voxels displayed,  62 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
sagittal montage:  21 voxels displayed, 317 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
sagittal montage: 165 voxels displayed, 1438 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
sagittal montage:  78 voxels displayed, 676 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
sagittal montage: 132 voxels displayed, 1647 not displayed on these slices
</pre>
<img vspace="5" hspace="5" src="compare_with_morel_04.png" alt=""> <pre class="codeoutput">Compressed NIfTI files are not supported.
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
coronal montage:  37 voxels displayed, 352 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
coronal montage:  16 voxels displayed, 164 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
coronal montage:  25 voxels displayed, 877 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
coronal montage:  38 voxels displayed, 256 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
coronal montage:   6 voxels displayed, 143 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
coronal montage:  34 voxels displayed, 225 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
coronal montage:   0 voxels displayed, 480 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
coronal montage:  26 voxels displayed,  89 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
coronal montage:  64 voxels displayed, 883 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
coronal montage:  24 voxels displayed, 204 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
coronal montage:  46 voxels displayed, 180 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
coronal montage:   2 voxels displayed,   7 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
coronal montage:  21 voxels displayed, 134 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
coronal montage:  11 voxels displayed, 146 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
coronal montage:  17 voxels displayed, 116 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
coronal montage:   2 voxels displayed, 402 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
coronal montage:  89 voxels displayed, 503 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
coronal montage:   3 voxels displayed,  87 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
coronal montage:  39 voxels displayed, 299 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
coronal montage: 143 voxels displayed, 1460 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
coronal montage: 128 voxels displayed, 626 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
coronal montage: 192 voxels displayed, 1587 not displayed on these slices
</pre>
<img vspace="5" hspace="5" src="compare_with_morel_05.png" alt=""> <pre class="codeoutput">Compressed NIfTI files are not supported.
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
axial montage:  29 voxels displayed, 360 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
axial montage:  29 voxels displayed, 151 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
axial montage:  92 voxels displayed, 810 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
axial montage:  58 voxels displayed, 236 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
axial montage:  51 voxels displayed,  98 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
axial montage:  11 voxels displayed, 248 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
axial montage:  36 voxels displayed, 444 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
axial montage:  15 voxels displayed, 100 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
axial montage:  97 voxels displayed, 850 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
axial montage:  35 voxels displayed, 193 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
axial montage:  29 voxels displayed, 197 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
axial montage:   0 voxels displayed,   9 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
axial montage:  44 voxels displayed, 111 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
axial montage:   0 voxels displayed, 157 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
axial montage:   0 voxels displayed, 133 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
axial montage:   7 voxels displayed, 397 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
axial montage:  38 voxels displayed, 554 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
axial montage:   3 voxels displayed,  87 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
axial montage:  27 voxels displayed, 311 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
axial montage:  64 voxels displayed, 1539 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
axial montage:  45 voxels displayed, 709 not displayed on these slices
Warning: Unknown input string option:existing_figure 
Warning: Unknown input string option:existing_axes 
axial montage: 113 voxels displayed, 1666 not displayed on these slices
</pre>
<img vspace="5" hspace="5" src="compare_with_morel_06.png" alt=""> <pre class="codeinput">
<span class="keyword">end</span>
</pre>
<pre class="codeoutput">Keeping probability_map values above 0.20
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Keeping probability_map values above 0.20
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
</pre>
<h2 id="7">compute overlap statistic</h2>
<pre class="codeinput">thresh = 0.2;
thisAtlas = myAtlas.resample_space(morel).threshold(0.2);
thisAtlas.probability_maps = [];
thisMorelAtlas = morel;

[newAtlas1, newAtlas2] = deal({});
<span class="keyword">for</span> i = 1:length(emap)
    newAtlas1{end+1} = thisAtlas.select_atlas_subset(emap{i}{1},<span class="string">'flatten'</span>);
    newAtlas2{end+1} = thisMorelAtlas.select_atlas_subset(emap{i}{2},<span class="string">'flatten'</span>);
<span class="keyword">end</span>
thisAtlas = [newAtlas1{:}];
thisMorelAtlas = [newAtlas2{:}];

<span class="keyword">for</span> i = 1:length(thisAtlas.labels)
    <span class="keyword">try</span>
        morel_roi = thisMorelAtlas.select_atlas_subset(thisAtlas.labels(i),<span class="string">'exact'</span>);
        my_roi = thisAtlas.select_atlas_subset(thisAtlas.labels(i),<span class="string">'exact'</span>);
    <span class="keyword">catch</span>
        <span class="keyword">continue</span>
    <span class="keyword">end</span>

    <span class="keyword">if</span> num_regions(morel_roi) == 1
        coef = 2*sum(morel_roi.dat.*my_roi.dat) / (sum(morel_roi.dat) + sum(my_roi.dat));
        d(i) = coef;
    <span class="keyword">elseif</span> num_regions(morel_roi) &gt; 1
        error(<span class="string">'Too many regions'</span>)
    <span class="keyword">end</span>
<span class="keyword">end</span>


figure;
hist(d(d~=0))
title(<span class="string">'Dice coefficient for LeadDBS Iglesias atlas vs. HCP278 Atlas'</span>)
xlabel(<span class="string">'Dice Coef.'</span>)
</pre>
<pre class="codeoutput">Keeping probability_map values above 0.20
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
Resampling space of atlas to add
Adding regions
</pre>
<img vspace="5" hspace="5" src="compare_with_morel_07.png" alt=""> <p class="footer">
<br>
<a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2023b</a>
<br>
</p>
</div>
<!--
##### SOURCE BEGIN #####
clear all;
close all;

addpath('/home/bogdan/.matlab/spm/spm12');
addpath(genpath('/home/bogdan/.matlab/canlab/CanlabCore'))
addpath(genpath('/home/bogdan/.matlab/canlab/Neuroimaging_Pattern_Masks'))
addpath(genpath('/home/bogdan/.matlab/canlab/MasksPrivate'))

leaddbsRoot='/home/bogdan/MyDocuments/canlab/atlases/_resources/LeadsDBS/';

myAtlas = load_atlas('iglesias_thal_fmriprep20');

% note, this requires MasksPrivate
morel = load_atlas('morel_fmriprep20')

%% plot overlaps

% equivalence mapping {{iglesias}, {morel}}
emap = {{{'AV'},{'AD','AM','AV'}},...
    {{'CeM'},{'CeM'}},...
    {{'CL'},{'CL'}},...
    {{'CM'},{'CM'}},...
    {{'LD'},{'LD'}},...
    {{'LGN'},{'LGNmc','LGNpc'}},...
    {{'LP'},{'LP'}},...
    {{'L_SG'},{'SG','Li'}},...
    {{'MDl'},{'MDpc'}},...
    {{'MDm'},{'MDmc'}},...
    {{'MGN'},{'MGN'}},...
    {{'MV_Re'},{'MV'}},...
    {{'Pf'},{'Pf'}},...
    {{'PuA'},{'PuA'}},...
    {{'PuI'},{'PuI','Po'}},...
    {{'PuL'},{'PuL'}},...
    {{'VA'},{'VApc'}},...
    {{'VAmc'},{'VAmc'}},...
    {{'VLa'},{'VLa'}},...
    {{'VLp'},{'VLpd','VLpv','VM'}},...
    {{'VPL'},{'VPLa','VPLp','VPI','VPM'}},...
    {{'PuMm','PuMl'},{'PuM'}}};

thisAtlas = myAtlas.select_atlas_subset({'L_'}).threshold(0.2);
thisAtlas = thisAtlas.select_atlas_subset(find(~contains(thisAtlas.labels,{'R_L'})));
thisAtlas.probability_maps = [];
thisMorelAtlas = morel.select_atlas_subset({'L_'});

[newAtlas1, newAtlas2] = deal({});
for i = 1:length(emap)
    newAtlas1{end+1} = thisAtlas.select_atlas_subset(emap{i}{1},'flatten');
    newAtlas2{end+1} = thisMorelAtlas.select_atlas_subset(emap{i}{2},'flatten');
end
thisAtlas = [newAtlas1{:}];
thisMorelAtlas = [newAtlas2{:}];

for orientation = {'saggital','coronal','axial'}
    %%
    o2 = thisAtlas.montage('transvalue',0.5,'regioncenters',orientation{1});
    for i = 1:num_regions(thisAtlas)
        try
            morel_roi = thisMorelAtlas.select_atlas_subset(i);
        
            if num_regions(morel_roi) == 1
                o3 = o2;
                o3.activation_maps = o2.activation_maps(i);
                o3.montage = o2.montage(i);
                morel_roi.montage(o3,'existing_figure','existing_axes', o2.montage{i}.axis_handles,'outline','color',[0,0,0]);
            end
        end
    end
    
    drawnow()
end


thisAtlas = myAtlas.select_atlas_subset({'R_'}).threshold(0.2);
thisAtlas.probability_maps = [];
thisMorelAtlas = morel.select_atlas_subset({'R_'});

[newAtlas1, newAtlas2] = deal({});
for i = 1:length(emap)
    newAtlas1{end+1} = thisAtlas.select_atlas_subset(emap{i}{1},'flatten');
    newAtlas2{end+1} = thisMorelAtlas.select_atlas_subset(emap{i}{2},'flatten');
end
thisAtlas = [newAtlas1{:}];
thisMorelAtlas = [newAtlas2{:}];

for orientation = {'saggital','coronal','axial'}
    %%
    o2 = thisAtlas.montage('transvalue',0.5,'regioncenters',orientation{1});
    for i = 1:num_regions(thisAtlas)
        try
            morel_roi = thisMorelAtlas.select_atlas_subset(i);
        
            if num_regions(morel_roi) == 1
                o3 = o2;
                o3.activation_maps = o2.activation_maps(i);
                o3.montage = o2.montage(i);
                morel_roi.montage(o3,'existing_figure','existing_axes', o2.montage{i}.axis_handles,'outline','color',[0,0,0]);
            end
        end
    end
    
    drawnow()
end

%% compute overlap statistic

thresh = 0.2;
thisAtlas = myAtlas.resample_space(morel).threshold(0.2);
thisAtlas.probability_maps = [];
thisMorelAtlas = morel;

[newAtlas1, newAtlas2] = deal({});
for i = 1:length(emap)
    newAtlas1{end+1} = thisAtlas.select_atlas_subset(emap{i}{1},'flatten');
    newAtlas2{end+1} = thisMorelAtlas.select_atlas_subset(emap{i}{2},'flatten');
end
thisAtlas = [newAtlas1{:}];
thisMorelAtlas = [newAtlas2{:}];

for i = 1:length(thisAtlas.labels)
    try
        morel_roi = thisMorelAtlas.select_atlas_subset(thisAtlas.labels(i),'exact');
        my_roi = thisAtlas.select_atlas_subset(thisAtlas.labels(i),'exact');
    catch
        continue
    end

    if num_regions(morel_roi) == 1
        coef = 2*sum(morel_roi.dat.*my_roi.dat) / (sum(morel_roi.dat) + sum(my_roi.dat));
        d(i) = coef;
    elseif num_regions(morel_roi) > 1
        error('Too many regions')
    end
end


figure;
hist(d(d~=0))
title('Dice coefficient for LeadDBS Iglesias atlas vs. HCP278 Atlas')
xlabel('Dice Coef.')


##### SOURCE END #####
-->
</body>
</html>
